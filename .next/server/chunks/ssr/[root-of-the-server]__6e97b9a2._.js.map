{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 143, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hansage/epicmo/app/user/page.tsx"],"sourcesContent":["\"use client\";\r\nimport React, { useState, useEffect } from \"react\";\r\nimport Sidebar from \"../components/Sidebar\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { toast } from \"react-toastify\";\r\nimport axios from \"axios\";\r\n\r\ntype User = {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  address: string;\r\n  role: string;\r\n  email?: string;\r\n};\r\n\r\ntype UserFormData = Omit<User, \"id\">;\r\n\r\nexport default function UserManagement() {\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [search, setSearch] = useState(\"\");\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [showAddModal, setShowAddModal] = useState(false);\r\n  const [editUser, setEditUser] = useState<User | null>(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [usersPerPage] = useState(6);\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    const fetchUsers = async () => {\r\n      try {\r\n        const response = await axios.get(\"http://192.168.110.100:8080/data1\");\r\n        console.log(\"API Response:\", response.data);\r\n\r\n        let usersData = response.data;\r\n        if (\r\n          usersData &&\r\n          typeof usersData === \"object\" &&\r\n          !Array.isArray(usersData)\r\n        ) {\r\n          if (Array.isArray(usersData.data)) {\r\n            usersData = usersData.data;\r\n          } else if (Array.isArray(usersData.users)) {\r\n            usersData = usersData.users;\r\n          }\r\n        }\r\n\r\n        if (!Array.isArray(usersData)) {\r\n          throw new Error(\"API did not return an array of users\");\r\n        }\r\n\r\n        const processedUsers = usersData.map((u: any, index: number) => {\r\n          const id = u.id?.toString() || `generated-${index}-${Date.now()}`;\r\n          return {\r\n            id,\r\n            name: u.name || \"No name\",\r\n            phone: u.phone || \"No phone\",\r\n            address: u.address || \"No address\",\r\n            role: u.role || \"user\",\r\n            email: u.email || \"\",\r\n          };\r\n        });\r\n\r\n        const idSet = new Set();\r\n        const duplicates = processedUsers.filter((user) => {\r\n          if (idSet.has(user.id)) {\r\n            console.warn(`Duplicate user ID detected: ${user.id}`);\r\n            return true;\r\n          }\r\n          idSet.add(user.id);\r\n          return false;\r\n        });\r\n\r\n        if (duplicates.length > 0) {\r\n          console.error(\"Duplicate users found:\", duplicates);\r\n          throw new Error(\"Duplicate user IDs detected in API response\");\r\n        }\r\n\r\n        setUsers(processedUsers);\r\n      } catch (err) {\r\n        console.error(\"Fetch error:\", err);\r\n        setError(err instanceof Error ? err.message : \"Unknown error occurred\");\r\n        toast.error(\"Gagal memuat data pengguna\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchUsers();\r\n  }, []);\r\n\r\n  const handleSaveNewUser = async (newUser: UserFormData) => {\r\n    try {\r\n      const response = await axios.post(\r\n        \"http://192.168.110.100:8080/data1\",\r\n        newUser\r\n      );\r\n      if (!response.data.id) {\r\n        throw new Error(\"API tidak mengembalikan ID yang valid\");\r\n      }\r\n\r\n      const createdUser: User = {\r\n        ...newUser,\r\n        id: response.data.id.toString(),\r\n      };\r\n\r\n      setUsers((prev) => [...prev, createdUser]);\r\n      setShowAddModal(false);\r\n      setCurrentPage(Math.ceil((users.length + 1) / usersPerPage));\r\n      toast.success(\"Pengguna berhasil ditambahkan\");\r\n    } catch (err) {\r\n      console.error(\"Error adding user:\", err);\r\n      toast.error(\"Gagal menambahkan pengguna\");\r\n    }\r\n  };\r\n\r\n  const handleSaveEditedUser = async (user: User) => {\r\n    try {\r\n      const response = await axios.put(\r\n        `http://192.168.110.100:8080/data1/edit/${user.id}`,\r\n        user\r\n      );\r\n\r\n      if (response.data?.status || response.status === 200) {\r\n        setUsers((prevUsers) =>\r\n          prevUsers.map((u) => (u.id === user.id ? user : u))\r\n        );\r\n\r\n        toast.success(\"Perubahan berhasil disimpan\");\r\n      } else {\r\n        toast.error(\"Gagal menyimpan perubahan\");\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Error updating user:\", err);\r\n      toast.error(\"Gagal menyimpan perubahan\");\r\n    }\r\n  };\r\n\r\n  const handleDeleteUser = async (userId: string) => {\r\n    try {\r\n      await axios.delete(`http://192.168.110.100:8080/data1/delete/${userId}`);\r\n\r\n      const updatedUsers = users.filter((u) => u.id !== userId);\r\n      setUsers(updatedUsers);\r\n\r\n      if (\r\n        updatedUsers.length > 0 &&\r\n        currentPage > Math.ceil(updatedUsers.length / usersPerPage)\r\n      ) {\r\n        setCurrentPage(Math.ceil(updatedUsers.length / usersPerPage));\r\n      }\r\n\r\n      toast.success(\"Pengguna berhasil dihapus\");\r\n    } catch (err) {\r\n      console.error(\"Error deleting user:\", err);\r\n      toast.error(\"Gagal menghapus pengguna\");\r\n    }\r\n  };\r\n\r\n  const filteredUsers = React.useMemo(() => {\r\n    const searchTerm = search.toLowerCase();\r\n    return users.filter(\r\n      (u) =>\r\n        u.name.toLowerCase().includes(searchTerm) ||\r\n        u.phone.includes(search) ||\r\n        u.address.toLowerCase().includes(searchTerm) ||\r\n        u.role.toLowerCase().includes(searchTerm) ||\r\n        (u.email && u.email.toLowerCase().includes(searchTerm))\r\n    );\r\n  }, [users, search]);\r\n\r\n  const indexOfLastUser = currentPage * usersPerPage;\r\n  const indexOfFirstUser = indexOfLastUser - usersPerPage;\r\n  const currentUsers = filteredUsers.slice(indexOfFirstUser, indexOfLastUser);\r\n  const totalPages = Math.ceil(filteredUsers.length / usersPerPage);\r\n\r\n  const paginate = (pageNumber: number) => setCurrentPage(pageNumber);\r\n\r\n  const handleEditClick = (user: User) => {\r\n    setEditUser(user);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* Komponen utama tetap seperti sebelumnya */}\r\n\r\n      {/* Tambahkan komponen modal edit */}\r\n      {editUser && (\r\n        <EditUserModal\r\n          user={editUser}\r\n          onSave={(updatedUser) => {\r\n            handleSaveEditedUser(updatedUser);\r\n            setEditUser(null);\r\n          }}\r\n          onCancel={() => setEditUser(null)}\r\n        />\r\n      )}\r\n\r\n      {/* Tambahkan modal tambah pengguna */}\r\n      {showAddModal && (\r\n        <AddUserModal\r\n          onSave={handleSaveNewUser}\r\n          onCancel={() => setShowAddModal(false)}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AAGA;AACA;AACA;AANA;;;;;;AAmBe,SAAS;IACtB,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAU,EAAE;IAC7C,MAAM,CAAC,QAAQ,UAAU,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACrC,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IAClD,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACjD,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAe;IACtD,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC/C,MAAM,CAAC,aAAa,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAChC,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IAEvB,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,aAAa;YACjB,IAAI;gBACF,MAAM,WAAW,MAAM,qIAAA,CAAA,UAAK,CAAC,GAAG,CAAC;gBACjC,QAAQ,GAAG,CAAC,iBAAiB,SAAS,IAAI;gBAE1C,IAAI,YAAY,SAAS,IAAI;gBAC7B,IACE,aACA,OAAO,cAAc,YACrB,CAAC,MAAM,OAAO,CAAC,YACf;oBACA,IAAI,MAAM,OAAO,CAAC,UAAU,IAAI,GAAG;wBACjC,YAAY,UAAU,IAAI;oBAC5B,OAAO,IAAI,MAAM,OAAO,CAAC,UAAU,KAAK,GAAG;wBACzC,YAAY,UAAU,KAAK;oBAC7B;gBACF;gBAEA,IAAI,CAAC,MAAM,OAAO,CAAC,YAAY;oBAC7B,MAAM,IAAI,MAAM;gBAClB;gBAEA,MAAM,iBAAiB,UAAU,GAAG,CAAC,CAAC,GAAQ;oBAC5C,MAAM,KAAK,EAAE,EAAE,EAAE,cAAc,CAAC,UAAU,EAAE,MAAM,CAAC,EAAE,KAAK,GAAG,IAAI;oBACjE,OAAO;wBACL;wBACA,MAAM,EAAE,IAAI,IAAI;wBAChB,OAAO,EAAE,KAAK,IAAI;wBAClB,SAAS,EAAE,OAAO,IAAI;wBACtB,MAAM,EAAE,IAAI,IAAI;wBAChB,OAAO,EAAE,KAAK,IAAI;oBACpB;gBACF;gBAEA,MAAM,QAAQ,IAAI;gBAClB,MAAM,aAAa,eAAe,MAAM,CAAC,CAAC;oBACxC,IAAI,MAAM,GAAG,CAAC,KAAK,EAAE,GAAG;wBACtB,QAAQ,IAAI,CAAC,CAAC,4BAA4B,EAAE,KAAK,EAAE,EAAE;wBACrD,OAAO;oBACT;oBACA,MAAM,GAAG,CAAC,KAAK,EAAE;oBACjB,OAAO;gBACT;gBAEA,IAAI,WAAW,MAAM,GAAG,GAAG;oBACzB,QAAQ,KAAK,CAAC,0BAA0B;oBACxC,MAAM,IAAI,MAAM;gBAClB;gBAEA,SAAS;YACX,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,gBAAgB;gBAC9B,SAAS,eAAe,QAAQ,IAAI,OAAO,GAAG;gBAC9C,mJAAA,CAAA,QAAK,CAAC,KAAK,CAAC;YACd,SAAU;gBACR,WAAW;YACb;QACF;QAEA;IACF,GAAG,EAAE;IAEL,MAAM,oBAAoB,OAAO;QAC/B,IAAI;YACF,MAAM,WAAW,MAAM,qIAAA,CAAA,UAAK,CAAC,IAAI,CAC/B,qCACA;YAEF,IAAI,CAAC,SAAS,IAAI,CAAC,EAAE,EAAE;gBACrB,MAAM,IAAI,MAAM;YAClB;YAEA,MAAM,cAAoB;gBACxB,GAAG,OAAO;gBACV,IAAI,SAAS,IAAI,CAAC,EAAE,CAAC,QAAQ;YAC/B;YAEA,SAAS,CAAC,OAAS;uBAAI;oBAAM;iBAAY;YACzC,gBAAgB;YAChB,eAAe,KAAK,IAAI,CAAC,CAAC,MAAM,MAAM,GAAG,CAAC,IAAI;YAC9C,mJAAA,CAAA,QAAK,CAAC,OAAO,CAAC;QAChB,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,sBAAsB;YACpC,mJAAA,CAAA,QAAK,CAAC,KAAK,CAAC;QACd;IACF;IAEA,MAAM,uBAAuB,OAAO;QAClC,IAAI;YACF,MAAM,WAAW,MAAM,qIAAA,CAAA,UAAK,CAAC,GAAG,CAC9B,CAAC,uCAAuC,EAAE,KAAK,EAAE,EAAE,EACnD;YAGF,IAAI,SAAS,IAAI,EAAE,UAAU,SAAS,MAAM,KAAK,KAAK;gBACpD,SAAS,CAAC,YACR,UAAU,GAAG,CAAC,CAAC,IAAO,EAAE,EAAE,KAAK,KAAK,EAAE,GAAG,OAAO;gBAGlD,mJAAA,CAAA,QAAK,CAAC,OAAO,CAAC;YAChB,OAAO;gBACL,mJAAA,CAAA,QAAK,CAAC,KAAK,CAAC;YACd;QACF,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,wBAAwB;YACtC,mJAAA,CAAA,QAAK,CAAC,KAAK,CAAC;QACd;IACF;IAEA,MAAM,mBAAmB,OAAO;QAC9B,IAAI;YACF,MAAM,qIAAA,CAAA,UAAK,CAAC,MAAM,CAAC,CAAC,yCAAyC,EAAE,QAAQ;YAEvE,MAAM,eAAe,MAAM,MAAM,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;YAClD,SAAS;YAET,IACE,aAAa,MAAM,GAAG,KACtB,cAAc,KAAK,IAAI,CAAC,aAAa,MAAM,GAAG,eAC9C;gBACA,eAAe,KAAK,IAAI,CAAC,aAAa,MAAM,GAAG;YACjD;YAEA,mJAAA,CAAA,QAAK,CAAC,OAAO,CAAC;QAChB,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,wBAAwB;YACtC,mJAAA,CAAA,QAAK,CAAC,KAAK,CAAC;QACd;IACF;IAEA,MAAM,gBAAgB,qMAAA,CAAA,UAAK,CAAC,OAAO,CAAC;QAClC,MAAM,aAAa,OAAO,WAAW;QACrC,OAAO,MAAM,MAAM,CACjB,CAAC,IACC,EAAE,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC,eAC9B,EAAE,KAAK,CAAC,QAAQ,CAAC,WACjB,EAAE,OAAO,CAAC,WAAW,GAAG,QAAQ,CAAC,eACjC,EAAE,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC,eAC7B,EAAE,KAAK,IAAI,EAAE,KAAK,CAAC,WAAW,GAAG,QAAQ,CAAC;IAEjD,GAAG;QAAC;QAAO;KAAO;IAElB,MAAM,kBAAkB,cAAc;IACtC,MAAM,mBAAmB,kBAAkB;IAC3C,MAAM,eAAe,cAAc,KAAK,CAAC,kBAAkB;IAC3D,MAAM,aAAa,KAAK,IAAI,CAAC,cAAc,MAAM,GAAG;IAEpD,MAAM,WAAW,CAAC,aAAuB,eAAe;IAExD,MAAM,kBAAkB,CAAC;QACvB,YAAY;IACd;IAEA,qBACE;;YAIG,0BACC,8OAAC;gBACC,MAAM;gBACN,QAAQ,CAAC;oBACP,qBAAqB;oBACrB,YAAY;gBACd;gBACA,UAAU,IAAM,YAAY;;;;;;YAK/B,8BACC,8OAAC;gBACC,QAAQ;gBACR,UAAU,IAAM,gBAAgB;;;;;;;;AAK1C","debugId":null}}]
}